var shop={};shop.currency={},shop.currency.value=1,shop.currency.RUB_USD=1,shop.currency.USD_RUB=1,$(document).ready(function(){$("#vk_groups").is("#vk_groups")&&VK.Widgets.Group("vk_groups",{mode:0,width:"135",height:"250",color1:"FFFFFF",color2:"264963",color3:"5B7FA6"},VKgroupID),jQ.facebook=$("#fb-root"),$("#fb-root").is("#fb-root")&&function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.0",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk");var a;a=setInterval(function(){if(jQ.facebook.html()){clearInterval(a),console.log("must die");var b,c=0;a=setInterval(function(){b=$(".fb-like-box > span:nth-child(1) > iframe:nth-child(1)"),b.css({width:"135px","margin-left":"5px","margin-top":"5px"}),c++>6&&(clearInterval(a),console.log("must must must"))},500)}},500),common.init(),shop.init()});var jQ={},common={};common.ajax=function(a,b,c,d){$.ajax({url:location.base,type:"post",data:{"do":a},success:function(a){if(a){var e;try{e=jQuery.parseJSON(a)}catch(f){d?console.error("error :: ["+d+" > common.ajax] json.parse error:"):console.error("error :: [common.ajax] json.parse error:"),console.log(a),c&&"function"==typeof c&&c()}e?e.error?(d?console.error("error :: ["+d+" > common.ajax] server error:"):console.error("error :: [common.ajax] server error:"),console.log(e.error),c&&"function"==typeof c&&c()):e?b&&"function"==typeof b&&b(e):d?console.error("error :: ["+d+" > common.ajax] wrong answer from server"):console.error("error :: [common.ajax] wrong answer from server"):d?console.error("error :: ["+d+" > common.ajax] empty server response or parse result"):console.error("error :: [common.ajax] empty server response or parse result")}},error:function(a){console.error(a)}})},common.events={},common.init=function(){common.events.init(),$(".product-image-container a").fancyzoom(),$("a.tozoom").fancyzoom({Speed:1e3}),$("a").fancyzoom({overlay:.8}),$(".product-image-container").click(function(){$(this).find("a").click()})},common.events.init=function(){common.events.click(),common.events.mouseenter(),common.events.mouseleave(),common.events.submit(),common.events.keydown(),common.events.focusin(),common.events.focusout()},common.events.click=function(){$(document).on("click",function(a){a=a||window.event;var b=$(a.target);if(b.is(".filter-color"))shop.filters.colorClicked(b);else if(b.is("#filters-apply"))shop.filters.submit();else if(b.is("#header-search-button"))shop.filters.submit();else if(b.is("#reviews-block-description-show"))$("#reviews-block .toggle").hide(),$("#reviews-block-description").show();else if(b.is("#reviews-block-reviews-show, .view-reviews"))$("#reviews-block .toggle").hide(),$("#reviews-block-reviews").show();else if(b.is("#reviews-block-delivery-show"))$("#reviews-block .toggle").hide(),$("#reviews-block-delivery").show();else if(b.is("#exit"))shop.customer.exit();else if(b.is(".button-field"))shop.customer.editField(b);else if(b.is("#great-gatsby"))win.hide();else if(b.is(".rating"))shop.product.setRating(b);else if(b.is("#window .close"))win.hide();else if(b.is("#exit"))shop.customer.exit();else if(b.is("#one-shot-one-hit"))shop.customer.oneShot();else if(b.is(".reviews-remove-button"))shop.customer.removeReview(b);else if(b.is(".quantity-up")){var c=Number(b.parent().find(".cart-product-quantity").val())+1;shop.product.productQuantityChange(b,c)}else if(b.is(".quantity-down")){var c=Number(b.parent().find(".cart-product-quantity").val())-1;shop.product.productQuantityChange(b,c)}else b.is("#add-to-cart")?shop.product.addToCartClick():b.is("#buy-one-click")?shop.product.buyOneClick():b.is("#cart-preview-table .remove")?shop.product.removeFromCart(b):b.is("#cart-product-table .remove")?shop.product.removeFromCart(b):b.is("#paymethods-table input[type=button]")?shop.paymethods.try():b.is("#paymethods-pay")?shop.paymethods.pay():b.is(".product-preview-image")?(jQ.productColors.removeClass("active"),$("#product-main-image img").attr({src:b.attr("src").split("80x80").join("400x400")}),$(".product-preview-image").addClass("nonactive"),b.removeClass("nonactive")):b.is(".product-color > span")&&shop.product.selectPictureColor(b)})},common.events.focusin=function(){$(document).on("focusin",function(a){var b=$(a.target);b.is("input, textrea")&&(b.data("placeholder",b.attr("placeholder")),b.attr("placeholder",""))})},common.events.focusout=function(){$(document).on("focusout",function(a){var b=$(a.target);b.is("input, textrea")&&b.attr("placeholder",b.data("placeholder"))})},common.events.mouseenter=function(){$(".product-block").on("mouseenter",function(a){var b=$(a.target);b.attr("src");var d=b.data("second");"/site/gcorp/images/products/no-image.png"!=d&&b.attr({src:d})})},common.events.mouseleave=function(){$(".product-block").on("mouseleave",function(a){var b=$(a.target);b.attr("src");var d=b.data("main");b.attr({src:d})})},common.events.submit=function(){$("form").on("submit",function(a){a.preventDefault();var b=$(a.target);b.is("#profile-module-block")?shop.customer.login():b.is("#reg-module-block")?shop.customer.registration():b.is("#add-review-form")&&shop.customer.addReview()})},common.events.keydown=function(){$(document).on("keydown",function(a){var b=$(a.target);13==a.keyCode&&(a.ctrlKey||a.shiftKey)&&(b.is("#add-review-form")?shop.customer.addReview():b.is("#header-search-input")&&shop.filters.submit()),13==a.keyCode&&b.is("#header-search-input")&&shop.filters.submit()})},common.events.keyup=function(){$(document).on("keyup",function(a){var b=$(a.target);b.is(".cart-product-quantity")&&shop.product.productQuantityChange(b,b.val())})},shop.currency.format=function(a,b,c){if(a){if(!b||!c){var d=a*shop.currency.RUB_USD;return d=Number.prototype.toFixed.call(parseFloat(d)||0,0),d=d.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "),d+" \u0440\u0443\u0431."}}else if(0==a)return"0 \u0440\u0443\u0431."},shop.currency.convert=function(a,b,c){if(a&&(!b||!c)){var d=a*shop.currency.RUB_USD;return d=Number.prototype.toFixed.call(parseFloat(d)||0,0)}},shop.init=function(){shop.filters.init(),shop.leftblock.init(),shop.leftblock.minicartReload();var a=$("#page").attr("page");""==a&&(a="index"),shop[a]?"function"==typeof shop[a].init?(shop[a].init(),console.log("success :: shop."+a+".init()")):console.error("error :: function shop."+a+".init() is not defined"):console.error("error :: cannot find shop."+a+".init()")},shop.filters={},shop.filters.init=function(){jQ.filters=$("#filters-block"),"index"==$("#page").attr("page")&&shop.filters.submit()},shop.filters.colorClicked=function(a){a&&(a.hasClass("active")?a.removeClass("active"):a.addClass("active"))},shop.filters.submit=function(){var a={};a.with="filters",a.start=0,a.quantity=16,"categories"==$("#page").attr("page")?a.category_id=$("#page").attr("data-id"):"subcategory"==$("#page").attr("page")?a.category_id=$("#page").attr("data-id"):"product"==$("#page").attr("page")&&(a.save=!0),$("#filter-price-from").val()&&(a.min_price=$("#filter-price-from").val(),a.min_price=a.min_price/shop.currency.RUB_USD,a.min_price=Number.prototype.toFixed.call(parseFloat(a.min_price)||0,0)),$("#filter-price-to").val()&&(a.max_price=$("#filter-price-to").val(),a.max_price=a.max_price/shop.currency.RUB_USD,a.max_price=Number.prototype.toFixed.call(parseFloat(a.max_price)||0,0));var b=new Array;jQ.filters.find(".active").each(function(){b[b.length]=$(this).data("color")}),b.length>0&&(a.colors=b),$("#header-search-input").val()&&(a.search=$("#header-search-input").val()),common.ajax(a,function(a){var c,b=new Array;a.length>0&&($.each(a,function(a,d){c=shop.filters.createElement(d),b[b.length]=c}),$("#products-list").html(b),$("body").scrollTop(830)),"product"==$("#page").attr("page")&&(location.href="/")})},shop.filters.createElement=function(a){var b;return b='<div num="'+a.product_id+'" class="product-block '+a.product_type+'">',b+='<div class="product-image-container">',b+='<a href="'+a.image+'">',b+='<img class="product-image" src="'+a.image+'"/>',b+="</a>",b+="</div>",a.product_old_price&&a.product_old_price>a.product_price&&"discount"==a.product_type&&(b+='<div class="product-old-price currency"><strike>'+shop.currency.format(a.product_old_price)+"</strike></div>"),b+='<div class="product-price currency">'+shop.currency.format(a.product_price)+"</div>",b+='<a href="'+a.path+'">',b+='<div class="product-name">'+a.product_name+"</div>",b+='<input type="button" value="'+a.button+'">',b+="</a>",b+="</div>"},shop.leftblock={},shop.leftblock.init=function(){$("#profile-module-block").is("div")&&(shop.leftblock.minicartReload(),jQ.loginField=$("#login"),jQ.passField=$("#password"))},shop.leftblock.minicartReload=function(){common.ajax({"with":"minicart",what:"load"},function(a){console.log("success: shop.leftblock.minicartReload()"),console.log("shop.leftblock.minicartReload :: answer : "),console.log(a),$("span.cart-count").text(a.quantity+" "+a.word),$("#cart-sum-number").text(shop.currency.format(a.total))},!1,"shop.leftblock.minicartReload")},shop.customer={},shop.customer.exit=function(){common.ajax({"with":"profile",what:"exit"},function(a){return"ok"==a.exit?(location.reload(),!1):(console.log("autorization error :: incorrect ajax answer: "+a),void 0)},!1,"shop.customer.exit")},shop.customer.login=function(){jQ.loginField=$("#login"),jQ.passField=$("#password"),jQ.signInButton=$("#sign-in-button");var a=jQ.loginField.val(),b=jQ.passField.val(),c=jQ.signInButton.parent().attr("href");common.ajax({"with":"profile",what:"login",login:a,pass:b},function(b){if(b.login==a)return location.reload(),!1;if(b.fail)switch(b.fail){case"online":location=c;break;default:console.log("autorization error :: "+b.fail),alert("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 e-mail \u043d\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d \u043d\u0430 \u0441\u0430\u0439\u0442\u0435 \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u0432\u0432\u0435\u0434\u0435\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u043e.")}else console.log("autorization error :: unknown error"),console.log(b)},!1,"shop.customer.login")},shop.index={},shop.product={},shop.categories={},shop.subcategories={},shop.profile={},shop.cart={},shop.paymethods={},shop.index.init=function(){},shop.product.init=function(){win.init($("#great-gatsby"),$("#great-gatsby #window")),jQ.cartTable=$("#cart-preview-table"),jQ.productColors=$(".product-color > span"),shop.product.loadReviews()},shop.product.setRating=function(a){common.ajax({"with":"products",what:"update",id:a.data("rating"),change:"rating",set:a.data("rating")},function(){alert("success")})},shop.product.buyOneClick=function(){win.show(function(){win.title.set($("#msg-buy-one-click-title").text()),win.content.set($("#msg-buy-one-click-content"))})},shop.product.addToCartClick=function(){win.show(function(){win.title.set($("#msg-product-add-title").text()),win.content.set($("#msg-product-add-content"))},function(){shop.product.addToCart()})},shop.product.addToCart=function(){common.ajax({"with":"cart",what:"add",id:$("#add-to-cart").data("id")},function(){shop.product.loadCart()},!1,"shop.product.addToCart")},shop.product.productQuantityChange=function(a,b){b>0&&common.ajax({"with":"cart",what:"change",id:a.closest("tr").data("id"),set:b},function(){$("#cart-product-table").is("table")?shop.cart.loadCart():$("#cart-preview-table").is("table")&&shop.product.loadCart(),console.log("quantity changed to : "+b),console.log(a)},!1,"shop.product.productQuantityChange")},shop.product.loadCart=function(){$("#loading-cart").show(),shop.leftblock.minicartReload(),common.ajax({"with":"cart",what:"load"},function(a){$("#loading-cart").hide();var b,c=0,d=new Array;console.log("success :: shop.product.loadCart :: answer"),console.log(a),$(".cart-product").remove(),$(".cart-product-hr").remove(),a.length>0&&$.each(a,function(a,e){b='<tr class="cart-product" data-id="'+e.id+'">',d[a]=e.quantity*e.price,c+=d[a],b+='<td class="remove">&#10005;</td>',b+='<td class="image"><img src="'+e.image+'"></td>',b+='<td class="name">'+e.name+"</td>",b+='<td class="quantity">',b+='<input class="cart-product-quantity" type="text" value="'+e.quantity+'"/>',b+='<div class="quantity-up">+</div>',b+='<div class="quantity-down">-</div>',b+="</td>",b+='<td class="price">'+shop.currency.format(e.price)+"</td>",b+='<td class="sum">'+shop.currency.format(e.sum)+"</td>",b+="</tr>",b+='<tr class="cart-product-hr"><td colspan="6"><hr></td></tr>',shop.product.setEvents(),$("#cart-preview-total").before($(b)),$("#cart-preview-table .total-sum").text(shop.currency.format(c))})},!1,"shop.product.loadCart")},shop.product.removeFromCart=function(a){var b=a.closest(".cart-product"),c=b.data("id");common.ajax({"with":"cart",what:"remove",id:c},function(){$(".cart-product").remove(),$(".cart-product-hr").remove(),$("#cart-product-table").is("table")?shop.cart.loadCart():$("#cart-preview-table").is("table")&&shop.product.loadCart()},!1,"shop.product.setEvents")},shop.product.setEvents=function(){$(".button-to-paymethods").on("click",function(){location="paymethods"})},shop.product.selectPictureColor=function(a){jQ.productColors.removeClass("active"),a.data("picture")&&(a.addClass("active"),$("#product-main-image img").attr("src",a.data("picture")))},shop.customer.oneShot=function(){common.ajax({"with":"product",what:"one-shot",id:$("#one-shot-one-hit").data("id"),user_name:$("#one-shot-name").val(),user_phone:$("#one-shot-phone").val(),user_email:$("#one-shot-email").val()},function(a){if(console.log(a),a.success)switch($("#one-shot-block input[type=text]").removeClass("incorrect"),a.success){case"too-few-data":$("#one-shot-block input[type=text]").addClass("incorrect");break;case"wrong-phone":$("#one-shot-phone").addClass("incorrect");break;case"wrong-email":$("#one-shot-email").addClass("incorrect");break;case"buy-one-click":win.hide(function(){shop.leftblock.minicartReload()},function(){console.log("shop.customer.oneShot :: success :"),console.log(a),alert("\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0437\u0430\u043a\u0430\u0437! \u041d\u0430\u0448 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u0432 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435 \u0432\u0440\u0435\u043c\u044f \u0441\u0432\u044f\u0436\u0435\u0442\u0441\u044f \u0441 \u0432\u0430\u043c\u0438.")});break;default:console.log(a)}else console.error("shop.customer.oneShot :: error :"),alert(a)},!1,"shop.customer.oneShot")},shop.customer.removeReview=function(a){jQ.reviews=$("#reviews-block-reviews"),common.ajax({"with":"reviews",what:"remove",id:jQ.reviews.data("product-id"),review_id:a.data("review-id")},function(b){b.fail?console.log("shop.customer.removeReview error :: "+b.fail):a.parent().remove()},!1,"shop.customer.addReview")},shop.customer.addReview=function(){jQ.reviews=$("#reviews-block-reviews"),common.ajax({"with":"reviews",what:"add",id:jQ.reviews.data("product-id"),name:$("#reviews-block-new-review-author").val(),text:$("#reviews-block-new-review-fild").val()},function(a){if(a.fail)console.log("shop.customer.addReview error :: "+a.fail);else{var b;b='<div class="reviews-block-review">',b+='<img src="'+a.image+'" class="review-image">',b+='<div class="reviews-block-name">',b+=a.author?a.author:"\u0410\u043d\u043e\u043d\u0438\u043c\u043d\u043e",b+="</div>",b+='<div class="reviews-block-text">'+a.text+"</div>",b+='<input type="button" class="reviews-remove-button" value="\u2715" data-review-id="'+a.review_id+'">',b+="</div>",jQ.reviews.append($(b)),$(window).scrollTop(100500)}},!1,"shop.customer.addReview")},shop.product.loadReviews=function(){jQ.reviews=$("#reviews-block-reviews"),common.ajax({"with":"reviews",what:"load",id:jQ.reviews.data("product-id")},function(a){if(a.length>0){var b;$.each(a,function(a,c){b='<div class="reviews-block-review">',b+='<img src="'+c.image+'" class="review-image">',b+='<div class="reviews-block-name">',b+=c.author?c.author:"\u0410\u043d\u043e\u043d\u0438\u043c\u043d\u043e",b+="</div>",b+='<div class="reviews-block-text">'+c.text+"</div>",b+="</div>",jQ.reviews.append($(b))})}else jQ.reviews.append($("<span>\u041d\u0438\u043a\u0442\u043e \u043f\u043e\u043a\u0430 \u043d\u0435 \u043e\u0441\u0442\u0430\u0432\u0438\u043b \u043e\u0442\u0437\u044b\u0432 \u043e\u0431 \u044d\u0442\u043e\u043c \u0442\u043e\u0432\u0430\u0440\u0435. \u0412\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u043f\u0435\u0440\u0432\u044b\u043c.</span>"))},!1,"shop.product.loadReviews")},shop.cart.title="",shop.cart.init=function(){jQ.cartTable=$("#cart-product-table"),jQ.button=$("#content input[type=button]"),""==shop.cart.title&&(shop.cart.title=$(".title").html()),$(".title").html("<td class='title-wide' colspan='6'>\u041a\u043e\u0440\u0437\u0438\u043d\u0430 \u043f\u0443\u0441\u0442\u0430</td>"),shop.cart.loadCart(),shop.cart.setEvents(),jQ.button.click(function(){return location="paymethods",!1})},shop.cart.setEvents=function(){$("#cart-product-table").on("click",".remove",function(){var a=$(this);a.parent();var c=a.data("id");common.ajax({"with":"cart",what:"remove",id:c},function(){$(".cart-product").remove(),$(".cart-product-hr").remove(),shop.cart.loadCart()},!1,"shop.cart.setEvents")})},shop.cart.loadCart=function(){$("#loading-cart").show(),common.ajax({"with":"cart",what:"load"},function(a){var b,c=0,d=new Array;$("#loading-cart").hide(),jQ.cartTable.find(".cart-product").remove(),jQ.cartTable.find(".cart-product-hr").remove(),a.length>0?(""!=shop.cart.title&&($(".title").html(shop.cart.title),shop.cart.title=""),console.log("shop.cart.loadCart :: answer: "),console.log(a),$.each(a,function(a,e){b='<tr class="cart-product" data-id="'+e.id+'">',d[a]=e.quantity*e.price,c+=d[a],b+='<td class="remove">&#10005;</td>',b+='<td class="image"><img src="'+e.image+'"></td>',b+='<td class="name">'+e.name+"</td>",b+='<td class="quantity">',b+='<input class="cart-product-quantity" data-id="'+e.id+'" type="text" value="'+e.quantity+'"/>',b+='<div class="quantity-up" data-id="'+e.id+'">+</div>',b+='<div class="quantity-down" data-id="'+e.id+'">-</div>',b+="</td>",b+='<td class="price">'+shop.currency.format(e.price)+"</td>",b+='<td class="sum">'+shop.currency.format(d[a])+"</td>",b+="</tr>",b+='<tr class="cart-product-hr"><td colspan="6"><hr></td></tr>',shop.cart.setEvents(),$("#cart-product-total").before($(b)),$("#cart-product-table .total-sum").text(shop.currency.format(c))})):(""==shop.cart.title&&(shop.cart.title=$(".title").html()),$(".title").html("<td class='title-wide' colspan='6'>\u041a\u043e\u0440\u0437\u0438\u043d\u0430 \u043f\u0443\u0441\u0442\u0430</td>"))},function(){$("#loading-cart").hide()},"shop.cart.loadCart")},shop.profile.init=function(){jQ.loginField=$("#login"),jQ.passField=$("#password"),jQ.userName=$("#avatar-block > h3"),jQ.userPhoto=$("#avatar-block > img"),shop.profile.dataReload(),$("#avatar-block").is("div")&&shop.leftblock.minicartReload()},shop.customer.registration=function(){jQ.regButton=$("#reg-in-button");var a=jQ.loginField.val(),b=jQ.passField.val(),c=jQ.regButton.parent().attr("href");common.ajax({"with":"profile",what:"reg",login:a,pass:b},function(b){if(b.success==a)console.log(b),alert("\u041d\u0430 \u043f\u043e\u0447\u0442\u043e\u0432\u044b\u0439 \u044f\u0449\u0438\u043a "+a+" \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u043f\u0438\u0441\u044c\u043c\u043e"),location=c;else if(b.fail)switch(b.fail){default:alert(b.fail)}else console.log("registration error :: unknown error"),console.log(b)},!1,"shop.customer.registration")},shop.customer.editField=function(a){var c,b=a.attr("field");switch(b){case"first-name":case"last-name":case"email":c=a.closest(".option").find(".option-field").val();break;case"sex":c=a.closest(".option").find("#sex-on-fire option:selected").val();break;case"pass":c=a.closest(".option").find(".option-field").val();break;default:console.log("shop.customer.editField error :: unknown field name input[field=???]")}c||(c=""),common.ajax({"with":"profile",what:"edit",field:b,set:c},function(a){if(shop.profile.dataReload(),a.success==b)console.log(a.success),alert("\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u0430\u044f \u0438\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430!");else if(a.fail)switch(a.fail){default:a.what?(alert("\u041f\u043e\u043b\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e!"),console.log("edit error :: ["+a.what+"] "+a.fail)):(alert("\u041f\u043e\u043b\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e!"),console.log("edit error :: [] "+a.fail))}else console.log("edit error :: unknown error"),console.log(a)},!1,"shop.customer.editField")},shop.profile.dataReload=function(){$("#avatar-block").is("div")&&common.ajax({"with":"profile",what:"reload"},function(a){jQ.userName.html(a.first_name+"<br>"+a.last_name),jQ.userPhoto.attr("src",a.photo)},!1,"shop.profile.dataReload")},shop.paymethods.init=function(){win.init($("#great-gatsby"),$("#great-gatsby #window")),jQ.cartTable=$("#cart-preview-table"),jQ.allPaymethods=$(".paymethods"),jQ.eachPaymethod=jQ.allPaymethods.find(".paymethod"),shop.paymethods.setEvents()},shop.paymethods.setEvents=function(){jQ.eachPaymethod.on("click",function(){var a=$(this);jQ.eachPaymethod.removeClass("active"),a.hasClass("active")||a.addClass("active")})},shop.paymethods.try=function(){common.ajax({"with":"paymethods",what:"try"},function(a){console.log(a),"online"==a.success?shop.paymethods.pay("online"):"offline"==a.success?win.show(function(){win.title.set($("#msg-buy-one-click-title").text()),win.content.set($("#msg-buy-one-click-content"))}):console.error("shop.paymethods.try :: server crazy answer")},!1,"shop.paymethods.try")},shop.paymethods.pay=function(a){var b=$(".paymethods").find(".active").data("method");console.log("shop.paymethods.pay :: selected "+b);var c=!1;$("#window #one-shot-block input[type=text]").removeClass("incorrect"),$("#window #one-shot-block input[type=text]").each(function(){""==$(this).val()&&($(this).addClass("incorrect"),c=!0)});var d;c?a&&(d={"with":"paymethods",what:"pay",method:b}):d={"with":"paymethods",what:"pay",method:b,user_name:$("#window #one-shot-block #one-shot-name").val(),user_email:$("#window #one-shot-block #one-shot-email").val(),user_phone:$("#window #one-shot-block #one-shot-phone").val()},(!c||a)&&common.ajax(d,function(a){console.log(a),"too-few-data"==a.success?($("#window #one-shot-block input[type=text]").removeClass("incorrect"),$("#window #one-shot-block input[type=text]").addClass("incorrect")):"wrong-phone"==a.success?(console.log("wrong-phone"),$("#window #one-shot-block #one-shot-phone").removeClass("incorrect"),$("#window #one-shot-block #one-shot-phone").addClass("incorrect")):"wrong-email"==a.success?(console.log("wrong-email"),$("#window #one-shot-block #one-shot-email").removeClass("incorrect"),$("#window #one-shot-block #one-shot-email").addClass("incorrect")):win.hide()},!1,"shop.paymethods.pay")};var win={};win.init=function(a,b){win.bg=a,win.body=b,win.close=win.body.find(".close"),win.title={},win.content={},win.title.inner=win.body.find(".window-title"),win.content.inner=win.body.find(".window-content"),win.title.set=function(a){win.title.inner.text(a)},win.content.set=function(a){"object"==typeof a?(win.body.css({width:a.css("width"),height:a.css("height")}),win.content.inner.html(a.html())):win.content.inner.html(a),win.resize()},$(window).resize(function(){win.resize()}),win.bg.hide(),win.body.hide(),win.resize()},win.resize=function(){var a=win.body.css("width"),b=win.body.css("height");a&&b?(win.width=a.substr(0,a.indexOf("px")),win.height=b.substr(0,b.indexOf("px"))):(win.width=240,win.height=180),win.width<240&&(win.width=240),win.height<180&&(win.height=180),win.clientWidth=$(window).width(),win.clientHeight=$(window).height(),win.body.css({position:"fixed",top:.5*(Number(win.clientHeight)-Number(win.height))+"px",left:.5*(Number(win.clientWidth)-Number(win.width))-10+"px"})},win.show=function(a,b){a&&a(),win.bg.show(),win.body.show(),b&&b()},win.hide=function(a,b){a&&a(),win.bg.hide(),win.body.hide(),b&&b()},$(function(){function b(a){return"number"!=typeof a?"":a>=1073741824?(a/1073741824).toFixed(2)+" GB":a>=1048576?(a/1048576).toFixed(2)+" MB":(a/1024).toFixed(2)+" KB"}var a=$("#upload ul");$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dropZone:$("#drop"),add:function(c,d){var e=$('<li class="working"><input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p><span></span></li>');e.find("p").text(d.files[0].name).append("<i>"+b(d.files[0].size)+"</i>"),d.context=e.appendTo(a),e.find("input").knob(),e.find("span").click(function(){e.hasClass("working")&&f.abort(),e.fadeOut(function(){e.remove()})});var f=d.submit()},progress:function(a,b){var c=parseInt(100*(b.loaded/b.total),10);b.context.find("input").val(c).change(),100==c&&b.context.removeClass("working")},fail:function(a,b){b.context.addClass("error")}}),$(document).on("drop dragover",function(a){a.preventDefault()})});