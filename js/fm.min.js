 $(function() {

 	$.ajax({
 		cache: false,
 		data: {
 			open: '<?=$_REQUEST[file]?>'
 		},
 		success: function(data) {
 			$('#keep').attr('value', data);
 		}
 	});
	//update({fm:{open:''}});

 	$('.del').click(function() {
 		$.ajax({
 			cache: false,
 			data: {
 				del: $(this).attr('href')
 			},
 			success: function() {
 				$(this).parent().parent().hide();
 			}
 		});
 		$(this).parent().parent().remove();
 		return false;
 	});

 	document.onkeyup = function(event) {
 		if (event.keyCode == 220) $.ajax({
 			data: {
 				save: '<?=$_REQUEST[file]?>'
 				,v: keep.value
 			}
 		});
 	};

	 $('#files').on('click', '.line:not(:first)', function() {
 		$(this).toggleClass('sel');
 	});
	$('#files').on('dblclick', '.line', function() {
		update({fm:{open_dir:$(this).find('.link').attr('href')}});c
 	});
 	$('a').click(function() {
 		$('.sel').removeClass('sel');
		return false;
 	});

 	$('#files').on('mouseover', '.rename', function() {
 		var $p = $(this).attr('value');
 		if (!$p) $p = null;
		update({fm:{preread:$p}});
 		// $('#preview').css('background-image', 'url("<?=$dir;?>'*/ + $(this).children().children('.rename').attr('value') + '")');
 	});

 	/*
  $('.line[id]').mouseout(function(){
   $('#preread').attr('value','');
   $('#preview').css('background-image','');
  });
*/
 	/*
  if($(document).width()<500)$('#files').css({'margin-left':0,width:'100%'});
  document.onresize=function(){if($(document).width()<500)$('#files').css({'margin-left':0,width:'100%'});else $('#files').css({'margin-left':'-250px',width:'500px'});};
*/

 	$('#replace').click(function() {
 		keep.value = keep.value.split(from.value).join(to.value);
 	});

 	$('.rename').change(function() {
 		$.ajax({
 			cache: false,
 			data: {
 				rename: $(this).parent().next().children().attr('href'),
 				newname: this.value
 			},
 			success: function() {
 				document.location.reload();
 			}
 		});
 	});

 });