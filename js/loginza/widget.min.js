if("undefined"==typeof LOGINZA||!LOGINZA)var LOGINZA={loaded:!1,token_url:null,selected_provider:null,providers_set:null,service_host:"http://loginza.ru",lang:null,ajax:!1,mobile:!1,callback:null,hash:""};LOGINZA.show=function(){if(LOGINZA.selected_provider=LOGINZA.getQueryStringValue(this,"provider"),LOGINZA.providers_set=LOGINZA.getQueryStringValue(this,"providers_set"),LOGINZA.token_url=LOGINZA.getQueryStringValue(this,"token_url"),LOGINZA.lang=LOGINZA.getQueryStringValue(this,"lang"),LOGINZA.mobile=LOGINZA.getQueryStringValue(this,"mobile"),"auto"==LOGINZA.mobile){var e=window.navigator.userAgent,t=["iPhone","Android","iPad","Opera Mobi","Kindle/3.0"];LOGINZA.mobile=!1;for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0){LOGINZA.mobile=!0;break}}else LOGINZA.mobile=LOGINZA.mobile?!0:!1;if(!LOGINZA.mobile&&!LOGINZA.loaded){var o=document.createElement("div");o.id="loginza_auth_form",o.style.overflow="visible",o.style.backgroundColor="transparent",o.style.zIndex="10000",o.style.position="fixed",o.style.display="block",o.style.top="0px",o.style.left="0px",o.style.textAlign="center",o.style.height="878px",o.style.width="1247px",o.style.paddingTop="125px",o.style.backgroundImage="url("+LOGINZA.service_host+"/img/widget/overlay.png)";var i=document.createElement("div");i.style.position="relative",i.style.display="inline",i.style.overflow="visible";var l=document.createElement("img");l.onclick=LOGINZA.close,l.style.position="relative",l.style.left="348px",l.style.top="-332px",l.style.cursor="hand",l.style.width="7px",l.style.height="7px",l.style.border="0",l.alt="X",l.title="Close",l.src=LOGINZA.service_host+"/img/widget/close.gif";var r=document.createElement("iframe");r.id="loginza_main_ifr",r.width="359",r.height="350",LOGINZA.mobile&&(r.width="320",r.height="480"),r.scrolling="no",r.frameBorder="0",r.src="javascript:'<html><body style=background-color:transparent><h1>Loading...</h1></body></html>'",i.appendChild(l),o.appendChild(i),o.appendChild(r);try{o.style.paddingTop=(window.innerHeight-350)/2+"px"}catch(d){o.style.paddingTop="100px"}o.style.paddingLeft=0,o.style.height="2000px",o.style.width=document.body.clientWidth+50+"px",document.body.appendChild(o),LOGINZA.loaded=!0,LOGINZA.ajax&&setInterval(LOGINZA.hashParser,500)}if(LOGINZA.token_url){var a=LOGINZA.service_host+"/api/widget.php?overlay=true&w="+document.body.clientWidth+"&token_url="+encodeURIComponent(LOGINZA.token_url)+"&provider="+encodeURIComponent(LOGINZA.selected_provider)+"&providers_set="+encodeURIComponent(LOGINZA.providers_set)+"&lang="+encodeURIComponent(LOGINZA.lang)+"&ajax="+(LOGINZA.ajax?"true":"false")+(LOGINZA.mobile?"&mobile=true":"");LOGINZA.mobile?document.location=a:document.getElementById("loginza_main_ifr").setAttribute("src",a)}else alert("Error token_url value!");return LOGINZA.mobile||(document.getElementById("loginza_auth_form").style.display=""),!1},LOGINZA.close=function(){document.getElementById("loginza_auth_form").style.display="none"},LOGINZA.resize=function(){var e=document.getElementById("loginza_auth_form");if(e){e.style.width=document.body.clientWidth+50+"px";try{e.style.paddingTop=(window.innerHeight-350)/2+"px"}catch(t){e.style.paddingTop="100px"}}},LOGINZA.getQueryStringValue=function(e,t){for(var n=e.href,o=null,i=n.match(/^[^?]*(?:\?([^#]*))?(?:$|#.*$)/)[1],l=new RegExp("([^=]+)=([^&]*)&?","g");null!=(o=l.exec(i));)if(decodeURIComponent(o[1])==t)return decodeURIComponent(o[2]);return null},LOGINZA.findClass=function(e,t){if(document.getElementsByClassName)return(t||document).getElementsByClassName(e);var n,o,i,t=t||document,l=t.getElementsByTagName("*"),r=l.length,d=e.split(/\s+/),a=d.length,s=[];for(n=0;r>n;n++){for(i=!0,o=0;a>o;o++)-1==l[n].className.search("\\b"+d[o]+"\\b")&&(i=!1);i&&s.push(l[n])}return s},LOGINZA.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},LOGINZA.init=function(){document.getElementById("loginza")&&void 0!=document.getElementById("loginza").href&&(document.getElementById("loginza").onclick=LOGINZA.show);var e,t=LOGINZA.findClass("loginza"),n=t.length;for(e=0;n>e;e++)void 0!=t[e].href&&(t[e].onclick=LOGINZA.show);LOGINZA.addEvent(window,"resize",LOGINZA.resize),LOGINZA.addEvent(document,"keydown",function(e){return e=e||window.event,27==e.keyCode&&LOGINZA.close(),!0})},LOGINZA.widget=function(){var e=document.getElementById("loginza_main_ifr");return e.contentDocument?e.contentDocument:e.contentWindow?e.contentWindow.document:e.document},LOGINZA.hashParser=function(){var e,t;try{var n=LOGINZA.widget().location.hash.substr(1),o=n.split(";"),i=[["token:","getToken"]];if(n!=LOGINZA.hash){for(var l=0;l<o.length;l++)for(var r=0;r<i.length;r++)e=i[r][1],t=o[l].substr(i[r][0].length),0===o[l].indexOf(i[r][0])&&LOGINZA[e](t);LOGINZA.hash=n}}catch(d){}},LOGINZA.getToken=function(e){LOGINZA.close(),LOGINZA.callback(e)},LOGINZA.scriptMessage=function(e){"undefined"!=typeof LOGINZA[e.data]&&LOGINZA[e.data]()},LOGINZA.redirect=function(){document.location=LOGINZA.service_host+"/api/redirect?rnd="+Math.random()},LOGINZA.addEvent(window,"load",LOGINZA.init),LOGINZA.addEvent(window,"message",LOGINZA.scriptMessage);